"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([["7814"],{57484:function(t,e,a){a.d(e,{AO:()=>i,Sz:()=>n});let i={userMemberships:{infinite:!0},userInvitations:{infinite:!0},userSuggestions:{infinite:!0,status:["pending","accepted"]}},n=(t,e,a)=>{var i;if(void 0===e)return[{data:[t],total_count:1}];let n=(null==e||null==(i=e[e.length-1])?void 0:i.total_count)||1;return e.map(e=>{if(void 0===e)return e;let i=e.data.map(e=>e.id===t.id?{...t}:e);return{...e,data:i,total_count:"negative"===a?n-1:n}})}},33738:function(t,e,a){a.r(e),a.d(e,{TaskChooseOrganization:()=>B,withOrganizationCreationEnabledGuard:()=>A}),a(65223);var i=a(73312),n=a(61869),o=a(69144),r=a(11576),l=a(64204),s=a(92418),c=a(2672),d=a(92654),u=a(54264),g=a(76028),h=a(25135),z=a(41024),p=a(20237),C=a(57484),v=a(86988),m=a(42305),O=a(35973),k=a(96519),Z=a(88870);let y=t=>{var e,a,n;let o=(0,c.useCardState)(),{ref:r,userMemberships:u,userSuggestions:h,userInvitations:z}=(0,g.H)(),C=(null==u?void 0:u.isLoading)||(null==z?void 0:z.isLoading)||(null==h?void 0:h.isLoading),v=(null==u?void 0:u.hasNextPage)||(null==z?void 0:z.hasNextPage)||(null==h?void 0:h.hasNextPage),O=null==(e=z.data)?void 0:e.filter(t=>!!t),k=null==(a=h.data)?void 0:a.filter(t=>!!t);return(0,i.BX)(i.HY,{children:[(0,i.BX)(d.h.Root,{showLogo:!0,sx:t=>({padding:"".concat(t.space.$none," ").concat(t.space.$8)}),children:[(0,i.tZ)(d.h.Title,{localizationKey:(0,l.localizationKeys)("taskChooseOrganization.chooseOrganization.title")}),(0,i.tZ)(d.h.Subtitle,{localizationKey:(0,l.localizationKeys)("taskChooseOrganization.chooseOrganization.subtitle")})]}),(0,i.tZ)(s.Z.Alert,{sx:t=>({margin:"".concat(t.space.$none," ").concat(t.space.$8)}),children:o.error}),(0,i.tZ)(l.Col,{elementDescriptor:l.descriptors.main,children:(0,i.tZ)(p.o2,{elementDescriptor:l.descriptors.taskChooseOrganizationPreviewItems,children:(0,i.BX)(m.eX,{role:"menu",children:[(u.count||0)>0&&(null==(n=u.data)?void 0:n.map(t=>(0,i.tZ)(_,{...t},t.id))),!u.hasNextPage&&(null==O?void 0:O.map(t=>(0,i.tZ)(b,{...t},t.id))),!u.hasNextPage&&!z.hasNextPage&&(null==k?void 0:k.map(t=>(0,i.tZ)(w,{...t},t.id))),(v||C)&&(0,i.tZ)(p.pr,{ref:r}),(0,i.tZ)(S,{onCreateOrganizationClick:()=>{o.setError(void 0),t.onCreateOrganizationClick()}})]})})})]})},_=t=>{let{user:e}=(0,n.aF)(),a=(0,c.useCardState)(),{navigateOnSetActive:o}=(0,v.G)(),{redirectUrlComplete:r}=(0,v._)(),{isLoaded:s,setActive:d}=(0,n.eW)(),{t:u}=(0,l.useLocalizations)();return s?(0,i.tZ)(p.Td,{elementDescriptor:l.descriptors.taskChooseOrganizationPreviewButton,onClick:()=>{let i;return i=t.organization,a.runAsync(async()=>{try{await d({organization:i,navigate:async t=>{let{session:e}=t;await (null==o?void 0:o({session:e,redirectUrlComplete:r}))}})}catch(i){var t,n;if(!(0,z.kD)(i))return void(0,Z.S3)(i,[],a.setError);switch(null==(n=i.errors)||null==(t=n[0])?void 0:t.code){case"organization_not_found_or_unauthorized":case"not_a_member_in_organization":(null==e?void 0:e.createOrganizationEnabled)?a.setError(u((0,l.localizationKeys)("unstable__errors.organization_not_found_or_unauthorized"))):a.setError(u((0,l.localizationKeys)("unstable__errors.organization_not_found_or_unauthorized_with_create_organization_disabled")));break;default:(0,Z.S3)(i,[],a.setError)}}})},children:(0,i.tZ)(O.Z,{elementId:"taskChooseOrganization",mainIdentifierSx:p.fq,organization:t.organization})}):null},b=t=>{let e=(0,c.useCardState)(),{getOrganization:a}=(0,n.cL)(),[r,s]=(0,o.useState)(null),{userInvitations:d}=(0,n.eW)({userInvitations:C.AO.userInvitations});return r?(0,i.tZ)(_,{organization:r}):(0,i.tZ)(p.ij,{organizationData:t.publicOrganizationData,elementId:"taskChooseOrganization",elementDescriptor:l.descriptors.taskChooseOrganizationPreviewItem,children:(0,i.tZ)(p.De,{isLoading:e.isLoading,onClick:()=>e.runAsync(async()=>[await t.accept(),await a(t.publicOrganizationData.id)]).then(t=>{var e;let[a,i]=t;null==d||null==(e=d.setData)||e.call(d,t=>(0,C.Sz)(a,t,"negative")),s(i)}).catch(t=>(0,Z.S3)(t,[],e.setError)),localizationKey:(0,l.localizationKeys)("taskChooseOrganization.chooseOrganization.action__invitationAccept")})})},w=(0,c.withCardStateProvider)(t=>{let e=(0,c.useCardState)(),{userSuggestions:a}=(0,n.eW)({userSuggestions:C.AO.userSuggestions});return(0,i.tZ)(p.ij,{organizationData:t.publicOrganizationData,elementId:"taskChooseOrganization",elementDescriptor:l.descriptors.taskChooseOrganizationPreviewItem,children:"accepted"===t.status?(0,i.tZ)(l.Text,{colorScheme:"secondary",localizationKey:(0,l.localizationKeys)("taskChooseOrganization.chooseOrganization.suggestionsAcceptedLabel")}):(0,i.tZ)(p.De,{onClick:()=>e.runAsync(t.accept).then(t=>{var e;return null==a||null==(e=a.setData)?void 0:e.call(a,e=>(0,C.Sz)(t,e))}).catch(t=>(0,Z.S3)(t,[],e.setError)),isLoading:e.isLoading,localizationKey:(0,l.localizationKeys)("taskChooseOrganization.chooseOrganization.action__suggestionsAccept")})})}),S=t=>{let{onCreateOrganizationClick:e}=t,{user:a}=(0,n.aF)();return(null==a?void 0:a.createOrganizationEnabled)?(0,i.tZ)(m.aU,{elementDescriptor:l.descriptors.taskChooseOrganizationCreateOrganizationActionButton,icon:k.mm,label:(0,l.localizationKeys)("taskChooseOrganization.chooseOrganization.action__createOrganization"),onClick:e,sx:t=>({borderTopWidth:t.borderWidths.$normal,borderTopStyle:t.borderStyles.$solid,borderTopColor:t.colors.$borderAlpha100,padding:"".concat(t.space.$5," ").concat(t.space.$5)}),iconSx:t=>({width:t.sizes.$9,height:t.sizes.$6})}):null};var f=a(70431),K=a(19460),x=a(68487),D=a(7259),P=a(36788);let $=t=>{let e=(0,c.useCardState)(),{navigateOnSetActive:a}=(0,v.G)(),{redirectUrlComplete:o}=(0,v._)(),{createOrganization:s,isLoaded:u,setActive:g}=(0,n.eW)({userMemberships:C.AO.userMemberships}),{organizationSettings:h}=(0,r.useEnvironment)(),z=(0,P.Yp)("name","",{type:"text",label:(0,l.localizationKeys)("taskChooseOrganization.createOrganization.formFieldLabel__name"),placeholder:(0,l.localizationKeys)("taskChooseOrganization.createOrganization.formFieldInputPlaceholder__name")}),p=(0,P.Yp)("slug","",{type:"text",label:(0,l.localizationKeys)("taskChooseOrganization.createOrganization.formFieldLabel__slug"),placeholder:(0,l.localizationKeys)("taskChooseOrganization.createOrganization.formFieldInputPlaceholder__slug")}),m=!h.slug.disabled,O=async t=>{if(t.preventDefault(),u)try{let t={name:z.value};m&&(t.slug=p.value);let e=await s(t);await g({organization:e,navigate:async t=>{let{session:e}=t;await (null==a?void 0:a({session:e,redirectUrlComplete:o}))}})}catch(t){(0,Z.S3)(t,[z,p],e.setError)}},k=t=>{p.setValue(t)},y=!z.value||!u;return(0,i.BX)(i.HY,{children:[(0,i.BX)(d.h.Root,{showLogo:!0,sx:t=>({padding:"".concat(t.space.$none," ").concat(t.space.$8)}),children:[(0,i.tZ)(d.h.Title,{localizationKey:(0,l.localizationKeys)("taskChooseOrganization.createOrganization.title")}),(0,i.tZ)(d.h.Subtitle,{localizationKey:(0,l.localizationKeys)("taskChooseOrganization.createOrganization.subtitle")})]}),(0,i.tZ)(x.Y,{sx:t=>({padding:"".concat(t.space.$none," ").concat(t.space.$10," ").concat(t.space.$8)}),children:(0,i.BX)(f.l.Root,{onSubmit:O,children:[(0,i.tZ)(f.l.ControlRow,{elementId:z.id,children:(0,i.tZ)(f.l.PlainInput,{...z.props,onChange:t=>{z.setValue(t.target.value),k((0,D.q)(t.target.value))},isRequired:!0,autoFocus:!0,ignorePasswordManager:!0})}),m&&(0,i.tZ)(f.l.ControlRow,{elementId:p.id,children:(0,i.tZ)(f.l.PlainInput,{...p.props,onChange:t=>k(t.target.value),isRequired:!0,pattern:"^(?=.*[a-z0-9])[a-z0-9\\-]+$",ignorePasswordManager:!0})}),(0,i.BX)(K.K,{sx:()=>({flexDirection:"column"}),children:[(0,i.tZ)(f.l.SubmitButton,{block:!0,isDisabled:y,localizationKey:(0,l.localizationKeys)("taskChooseOrganization.createOrganization.formButtonSubmit")}),t.onCancel&&(0,i.tZ)(f.l.ResetButton,{localizationKey:(0,l.localizationKeys)("taskChooseOrganization.createOrganization.formButtonReset"),onClick:t.onCancel})]})]})})]})},I=()=>{var t,e;let{signOut:a}=(0,n.cL)(),{user:o}=(0,n.aF)(),{session:c}=(0,n.kP)(),{otherSessions:d}=(0,u.j)({user:o}),{navigateAfterSignOut:g,navigateAfterMultiSessionSingleSignOutUrl:h}=(0,r.useSignOutContext)(),z=null!=(e=null==o||null==(t=o.primaryEmailAddress)?void 0:t.emailAddress)?e:null==o?void 0:o.username;return(0,i.tZ)(s.Z.Footer,{children:(0,i.BX)(s.Z.Action,{elementId:"signOut",gap:2,justify:"center",sx:()=>({width:"100%"}),children:[z&&(0,i.tZ)(s.Z.ActionText,{truncate:!0,localizationKey:(0,l.localizationKeys)("taskChooseOrganization.signOut.actionText",{identifier:z})}),(0,i.tZ)(s.Z.ActionLink,{sx:()=>({flexShrink:0}),onClick:()=>0===d.length?a(g):a(h,{sessionId:null==c?void 0:c.id}),localizationKey:(0,l.localizationKeys)("taskChooseOrganization.signOut.actionLink")})]})})},L=(0,c.withCardStateProvider)(t=>{let[e,a]=(0,o.useState)(t.initialFlow);return"create"===e?(0,i.tZ)($,{onCancel:"choose"===t.initialFlow?()=>a("choose"):void 0}):(0,i.tZ)(y,{onCreateOrganizationClick:()=>a("create")})}),A=t=>e=>{let{user:a}=(0,n.aF)();return(null==a?void 0:a.createOrganizationEnabled)?(0,i.tZ)(t,{...e}):(0,i.tZ)(F,{})};function F(){return(0,i.tZ)(l.Flow.Root,{flow:"taskChooseOrganization",children:(0,i.tZ)(l.Flow.Part,{part:"organizationCreationDisabled",children:(0,i.BX)(s.Z.Root,{children:[(0,i.tZ)(s.Z.Content,{children:(0,i.BX)(d.h.Root,{showLogo:!0,children:[(0,i.tZ)(d.h.Title,{localizationKey:(0,l.localizationKeys)("taskChooseOrganization.organizationCreationDisabled.title")}),(0,i.tZ)(d.h.Subtitle,{localizationKey:(0,l.localizationKeys)("taskChooseOrganization.organizationCreationDisabled.subtitle")})]})}),(0,i.tZ)(I,{})]})})})}let B=(0,r.withCoreSessionSwitchGuard)((0,h.U)((0,c.withCardStateProvider)(A(()=>{let{userMemberships:t,userSuggestions:e,userInvitations:a}=(0,g.H)(),n=(null==t?void 0:t.isLoading)||(null==a?void 0:a.isLoading)||(null==e?void 0:e.isLoading),o=!!((null==t?void 0:t.count)||(null==a?void 0:a.count)||(null==e?void 0:e.count));return(0,i.tZ)(l.Flow.Root,{flow:"taskChooseOrganization",children:(0,i.tZ)(l.Flow.Part,{part:"chooseOrganization",children:(0,i.BX)(s.Z.Root,{children:[(0,i.tZ)(s.Z.Content,{sx:t=>({padding:"".concat(t.space.$8," ").concat(t.space.$none," ").concat(t.space.$none),gap:t.space.$7}),children:n?(0,i.tZ)(l.Flex,{direction:"row",align:"center",justify:"center",sx:t=>({height:"100%",minHeight:t.sizes.$100}),children:(0,i.tZ)(l.Spinner,{size:"lg",colorScheme:"primary",elementDescriptor:l.descriptors.spinner})}):(0,i.tZ)(L,{initialFlow:o?"choose":"create"})}),(0,i.tZ)(I,{})]})})})})),"choose-organization"))},25135:function(t,e,a){a.d(e,{U:()=>r});var i=a(95274),n=a(96231),o=a(86988);let r=(t,e)=>{let a=t.displayName||t.name||"Component";t.displayName=a;let r=a=>{let r=(0,o.G)();return(0,n.me)(t,t=>{var a;return!(null==(a=t.session)?void 0:a.currentTask)||t.session.currentTask.key!==e&&!t.__internal_setActiveInProgress},t=>{var e;let{clerk:a}=t;return a.session?null!=(e=r.redirectUrlComplete)?e:a.buildAfterSignInUrl():a.buildSignInUrl()},i.q.cannotRenderComponentWhenTaskDoesNotExist)(a)};return r.displayName="withTaskGuard(".concat(a,")"),r}}}]);